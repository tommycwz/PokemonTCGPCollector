<div class="container">
  <div *ngIf="error" class="error">
    {{ error }}
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <h2>Loading your collection...</h2>
    <div class="loading-spinner"></div>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">

    <div class="suggestion-controls" style="margin: 8px 0 16px; display: flex; justify-content: flex-end; align-items: center; gap: 12px;">
      <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer;">
        <input type="checkbox" [(ngModel)]="excludeDeluxePack" (ngModelChange)="excludeModelChange()" />
        Exclude A4B - DELUXE PACK
      </label>
    </div>

    <!-- Pack Suggestions -->
    <div class="pack-suggestions" *ngIf="packSuggestions.length > 0">
      <details open>
        <summary>üéÅ Pack Opening Suggestions</summary>
        <p class="suggestion-subtitle">Optimized recommendations based on your missing cards</p>
        <div class="suggestions-list">
          <ng-container *ngFor="let suggestion of packSuggestions; let i = index">
            <div class="suggestion-item"
                 *ngIf="!excludeDeluxePack || !isDeluxeA4B(suggestion.packName)"
                 [class.top-pick]="i === 0">
              <div class="suggestion-header">
                <span class="rank-number">#{{ i + 1 }}</span>
                <span *ngIf="i === 0" class="top-pick-badge">üèÜ TOP PICK</span>
                <strong>{{ suggestion.packName }}</strong>
                <span class="pack-set" *ngIf="suggestion.primarySetCode">[{{ suggestion.primarySetCode }}] - {{ suggestion.primarySetName }}</span>
              </div>
              <div class="suggestion-summary">
                <span class="missing-count">{{ suggestion.missingCards }} missing cards</span>
                <span class="completion-rate">{{ suggestion.completionPercentage }}% complete</span>
                <span class="progress-count">({{ suggestion.ownedCards }}/{{ suggestion.totalCards }})</span>
              </div>
            </div>
          </ng-container>
        </div>
      </details>
    </div>

    <!-- Set Progress -->
    <div class="set-progress" *ngIf="setProgress.length > 0">
      <details>
        <summary>üì¶ Set Completion Progress</summary>
        <div class="progress-list">
          <ng-container *ngFor="let set of setProgress">
          <div class="progress-item" *ngIf="set.total > 0">
            <div class="progress-header">
              <h4>[{{ set.code }}] - {{ set.name }}</h4>
              <span class="progress-percentage">{{ set.percentage }}%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="set.percentage"></div>
            </div>
            <p class="progress-details">{{ set.owned }}/{{ set.total }} cards</p>

            <!-- Rarity breakdown for this set -->
            <div class="set-rarity-breakdown" *ngIf="set.rarityBreakdown && set.rarityBreakdown.length > 0">
              <h5>Rarity Progress:</h5>
              <div class="set-rarity-grid">
                <div *ngFor="let rarity of set.rarityBreakdown" class="set-rarity-item"
                  [ngClass]="'rarity-' + rarity.code"
                  [attr.title]="rarity.name + ': ' + rarity.owned + '/' + rarity.total + ' (' + rarity.percentage + '%)'">
                  <span class="rarity-name">{{ rarity.name }}</span>
                  <div class="rarity-mini-progress">
                    <div class="rarity-mini-bar">
                      <div class="rarity-mini-fill" [style.width.%]="rarity.percentage"></div>
                    </div>
                    <span class="rarity-mini-text">{{ rarity.owned }}/{{ rarity.total }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          </ng-container>
        </div>
      </details>
    </div>

    <!-- Rarity Breakdown -->
    <div class="rarity-breakdown" *ngIf="userRarityStats.length > 0">
      <details>
        <summary>‚≠ê Collection by Rarity</summary>
        <div class="rarity-grid">
          <ng-container *ngFor="let rarity of userRarityStats">
            <div class="rarity-card" *ngIf="rarity.total > 0" [ngClass]="'rarity-' + rarity.code"
              [attr.title]="rarity.name + ': ' + rarity.owned + '/' + rarity.total + ' (' + rarity.percentage + '%)'"><!--  -->
              <div class="rarity-header">
                <h4>{{ rarity.name }}</h4>
                <span class="rarity-count">{{ rarity.owned }}/{{ rarity.total }}</span>
              </div>
              <div class="rarity-progress">
                <div class="rarity-bar">
                  <div class="rarity-fill" [style.width.%]="rarity.percentage"></div>
                </div>
                <span class="percentage">{{ rarity.percentage }}%</span>
              </div>
            </div>
          </ng-container>
        </div>
      </details>
    </div>
  </div>
</div>