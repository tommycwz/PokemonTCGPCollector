<div class="suggestion-container">

    <div class="filter-section">

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-state">
            <div class="spinner"></div>
            <p>Calculating pack suggestions...</p>
        </div>

        <!-- No User State -->
        <div *ngIf="!isLoading && !currentUser" class="no-user-state">
            <p>Please sign in to get personalized pack suggestions.</p>
        </div>

        <!-- Suggestions List -->
        <div *ngIf="!isLoading && currentUser && packSuggestions.length > 0" class="suggestions-list">
            <div class="suggestions-header-row">
                <h3>Recommended Packs ({{ packSuggestions.length }} available)</h3>
                <select class="set-filter" [(ngModel)]="selectedSeriesFilter" (change)="onSeriesFilterChange()">
                    <option value="top-3">Top 3 Suggestions</option>
                    <optgroup label="Series">
                        <option *ngFor="let ser of seriesList" [value]="ser">{{ ser }}</option>
                    </optgroup>
                </select>
            </div>

            <div class="suggestion-item" *ngFor="let suggestion of packSuggestions; let i = index">
                <div class="suggestion-content">
                    <div class="suggestion-header">
                        <div class="header-left">
                            <h4 class="pack-name">{{ i + 1 }}. {{ suggestion.packName }}</h4>
                        </div>
                        <div class="header-right">
                            <span class="set-code">{{ suggestion.setCode }}</span>
                            <span class="set-name">{{ suggestion.setName }}</span>
                        </div>
                    </div>

                    <div class="suggestion-stats">
                        <div class="stat-item">
                            <span class="stat-label">New Card Chance</span>
                            <span class="stat-value chance">{{ suggestion.newCardChance.toFixed(1) }}%</span>
                        </div>

                        <div class="stat-item">
                            <span class="stat-label">Missing Cards</span>
                            <span class="stat-value missing">{{ suggestion.missingCards }}/{{ suggestion.totalCards
                                }}</span>
                        </div>

                        <div class="stat-item">
                            <span class="stat-label">Collection</span>
                            <span class="stat-value percentage">{{ suggestion.percentage.toFixed(1) }}% complete</span>
                        </div>
                    </div>

                    <!-- Rarity Breakdown -->
                    <div *ngIf="suggestion.rarityBreakdown.length > 0" class="rarity-breakdown">
                        <h5>Rarity Breakdown:</h5>
                        <div class="rarity-grid">
                            <div *ngFor="let breakdown of suggestion.rarityBreakdown" class="rarity-item clickable" [class.complete]="breakdown.percentage === 100" (click)="onRarityClick(suggestion, breakdown)" tabindex="0">
                                <span class="rarity-symbol" [title]="getRarityDisplayName(breakdown.rarity)">
                                    {{ getRaritySymbol(breakdown.rarity) }}
                                </span>
                                <span class="rarity-count">
                                    {{ breakdown.owned }}/{{ breakdown.total }}
                                </span>
                                <span class="rarity-percentage" [class.complete]="breakdown.percentage === 100">
                                    {{ breakdown.percentage.toFixed(0) }}%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- No Suggestions State -->
    <div *ngIf="!isLoading && currentUser && packSuggestions.length === 0" class="no-suggestions">
        <p>üéâ Congratulations! You have completed your collection according to the selected algorithm.</p>
        <p>Try a different algorithm to find more cards to collect.</p>
    </div>

    <!-- Floating Action Button for Special Packs Filter -->
    <button class="fab fab-special" (click)="excludeSpecialPacks = !excludeSpecialPacks; onExcludeSpecialPacksChange()" 
            [ngClass]="{
              'fab-excluding': excludeSpecialPacks,
              'fab-including': !excludeSpecialPacks
            }"
            [title]="excludeSpecialPacks ? 'Excluding Special Packs' : 'Including Special Packs'">
        <span *ngIf="excludeSpecialPacks">üö´</span>
        <span *ngIf="!excludeSpecialPacks">üì¶</span>
    </button>

    <!-- Floating Action Button for Rarity Filter -->
    <button class="fab fab-rarity" (click)="onRarityFilterChange()" 
            [ngClass]="{
              'fab-tradable': rarityFilterMode === 'tradable',
              'fab-common': rarityFilterMode === 'common',
              'fab-all': rarityFilterMode === 'all'
            }"
            [title]="rarityFilterMode === 'tradable' ? 'Tradable cards: ‚óä-‚óä‚óä‚óä‚óä, ‚òÜ, ‚òÜ‚òÜ' : (rarityFilterMode === 'common' ? 'Common only: ‚óä-‚óä‚óä‚óä‚óä, ‚òÜ' : 'All rarities')">
        <span *ngIf="rarityFilterMode === 'tradable'">‚≠ê</span>
        <span *ngIf="rarityFilterMode === 'common'">üíé</span>
        <span *ngIf="rarityFilterMode === 'all'">üëë</span>
    </button>

</div>